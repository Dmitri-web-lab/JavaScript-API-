<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<title>Javascript про API браузеров - homework</title>
</head>

<body>
	<div class="container mt-5">
		<h1 class="mb-3">Расписание занятий</h1>
		<ul class="list-group" id="lessonsList">
			<!-- Область для отображения занятий -->
		</ul>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
	<script>
		// Данные о занятиях
		const lessonsData = [
			{
				title: 'Легкая атлетика',
				time: '10:00',
				maxParticipants: 15,
				recordedParticipants: 8
			},
			{
				title: 'Бокс',
				time: '12:00',
				maxParticipants: 10,
				recordedParticipants: 6
			},
			{
				title: 'Плавание',
				time: '14:00',
				maxParticipants: 5,
				recordedParticipants: 2
			}
		];
// Выгружаем все данные о занятиях на страницу в блок с id lessonsList
		lessonsData.forEach(element => {
			const lessonsItem = createLessons(element); // Передаем в функцию каждый блок из массива данных
			lessonsList.append(lessonsItem); // и добавляем на страницу
		});

		function createLessons(data) {
			const lessonsItem = document.createElement('li'); // Создаем каждое занятие
			lessonsItem.classList.add('list-group-item');

			const lessonsTitle = document.createElement('h2'); // Добавляем название занятия
			lessonsTitle.classList.add('mb-3');
			lessonsTitle.textContent = data.title;

			const lessonsTime = document.createElement('p'); // Время проведения
			lessonsTime.textContent = `Начало занятия в ${data.time}`;

			const lessonsParticipants = document.createElement('p'); // Количество записавшихся и максимальное количество участников
			lessonsParticipants.classList.add('maxRecord')
			lessonsParticipants.textContent = `Всего записались: ${data.recordedParticipants} из ${data.maxParticipants}`;

			const addRecordButton = document.createElement('button'); // Создаем кнопку "Записаться"
			addRecordButton.textContent = 'Записаться';
			addRecordButton.classList.add('btn', 'btn-success');

			const cancelRecordButton = document.createElement('button'); // Создаем кнопку "Отменить запись"
			cancelRecordButton.textContent = 'Отменить запись';
			cancelRecordButton.classList.add('btn', 'btn-danger');

			// Добавляем поочередно в блок занятия 
			lessonsItem.append(lessonsTitle);
			lessonsItem.append(lessonsTime);
			lessonsItem.append(lessonsParticipants);
			lessonsItem.append(addRecordButton);
			lessonsItem.append(cancelRecordButton);

			return lessonsItem; // Возвращаем готовый блок
		}

		lessonsList.addEventListener('click', function (e) { // Создаем событие "Клик" с использованием target
			if (e.target.textContent == 'Записаться') { // Проверяем на какую кнопку было нажатие
				const lessonsItem = e.target.closest('li'); // В блоке, где было нажатие кнопки получаем блок занятия
				const lessonsTitle = lessonsItem.querySelector('h2'); // Название занятия
				const maxRecord = lessonsItem.querySelector('.maxRecord'); // Параграф для записи участников

				lessonsData.forEach(element => { // Ищем в исходном массиве с данными объект нужным нам заголовком
					if (element.title == lessonsTitle.textContent) { // Путем сравнения находим заголовок
						let newRecord = ++element.recordedParticipants; // Инкрементируем число записавшихся участников
						let getMaxParticipants = element.maxParticipants; // Получаем максимально допустимое число участников для сравнения
						maxRecord.textContent = `Всего записались: ${newRecord} из ${getMaxParticipants}`; // Записываем на страницу обновленное значение
						if (newRecord == getMaxParticipants) { // Сравниваем, если количество записавшихся участников равно максимальному числу участников
							e.target.setAttribute('disabled', ''); // тогда устанавливаем для кнопки "Записаться" атрибут "disabled"
						}
						if (newRecord != getMaxParticipants || e.target.nextElementSibling.getAttribute('disabled')) { // Также проверяем на не равное число записавшихся участников к максимальному и если кнопка "Отменить запись" с атрибутом "disabled"
							e.target.nextElementSibling.removeAttribute('disabled'); // При соблюдении условий убираем у кнопки "disabled"
						}
					}
				})

			} else if (e.target.textContent == 'Отменить запись') { // Если нажата кнопка "Отменить запись"
				const lessonsItem = e.target.closest('li'); // В блоке, где было нажатие кнопки получаем блок занятия
				const lessonsTitle = lessonsItem.querySelector('h2'); // Название занятия
				const maxRecord = lessonsItem.querySelector('.maxRecord'); // Параграф для записи участников

				lessonsData.forEach(element => { // Проделываем то же самое что в строке 90
					if (element.title == lessonsTitle.textContent) {
						let newRecord = --element.recordedParticipants; // только тут декрементируем число участников
						let getMaxParticipants = element.maxParticipants;
						maxRecord.textContent = `Всего записались: ${newRecord} из ${getMaxParticipants}`;
						if (newRecord == 0) {
							e.target.setAttribute('disabled', '');
						}
						if (newRecord != getMaxParticipants || e.target.previousElementSibling.getAttribute('disabled')) { // Также проверка, чтобы убрать у кнопки "Записаться" атрибут "disabled"
							e.target.previousElementSibling.removeAttribute('disabled');
						}
					}
				})

			}
		});
	</script>
</body>

</html>